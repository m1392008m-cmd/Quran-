<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>المصحف الشريف - العرض الملكي الزجاجي</title>
    <style>
        :root {
            --gold: #d4af37;
            --royal-bg: #0a0e17;
            --laser: #00f2ff;
            --glass: rgba(255, 255, 255, 0.07);
        }

        body {
            margin: 0;
            background: radial-gradient(circle at top, #1a2a6c, #0a0e17, #000);
            color: #fff;
            font-family: 'Amiri', serif;
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        /* التصميم الزجاجي الملكي */
        #quran-hub {
            background: var(--glass);
            backdrop-filter: blur(25px);
            -webkit-backdrop-filter: blur(25px);
            border: 2px solid var(--gold);
            border-radius: 30px;
            width: 95%;
            max-width: 1000px;
            padding: 40px;
            box-shadow: 0 0 50px rgba(212, 175, 55, 0.2), inset 0 0 20px rgba(0, 242, 255, 0.1);
            position: relative;
        }

        h1 {
            text-align: center;
            color: var(--gold);
            font-size: 2.8rem;
            text-shadow: 0 0 15px var(--gold);
            margin-bottom: 30px;
            border-bottom: 1px double var(--gold);
            padding-bottom: 15px;
        }

        .controls {
            display: flex;
            gap: 15px;
            margin-bottom: 30px;
        }

        select, button {
            background: rgba(0, 0, 0, 0.5);
            border: 1px solid var(--gold);
            color: var(--gold);
            padding: 12px 20px;
            border-radius: 12px;
            font-size: 1.2rem;
            cursor: pointer;
            transition: 0.3s;
        }

        select:hover, button:hover {
            background: var(--gold);
            color: #000;
            box-shadow: 0 0 15px var(--gold);
        }

        /* منطقة النص الليزري */
        #display-area {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 20px;
            padding: 40px;
            font-size: 2.2rem;
            line-height: 2.8;
            text-align: center;
            max-height: 60vh;
            overflow-y: auto;
            border: 1px inset rgba(0, 242, 255, 0.3);
            box-shadow: inset 0 0 30px rgba(0,0,0,0.5);
        }

        .ayah { position: relative; display: inline; }
        
        .ayah-num {
            display: inline-flex;
            width: 45px;
            height: 45px;
            border: 2px solid var(--gold);
            border-radius: 50%;
            justify-content: center;
            align-items: center;
            font-size: 1.1rem;
            margin: 0 15px;
            color: var(--laser);
            text-shadow: 0 0 5px var(--laser);
            background: rgba(0,0,0,0.4);
        }

        /* تحسين السكرول */
        #display-area::-webkit-scrollbar { width: 6px; }
        #display-area::-webkit-scrollbar-thumb { background: var(--gold); border-radius: 10px; }

        .loading-overlay { text-align: center; font-size: 1.5rem; color: var(--gold); }
    </style>
</head>
<body>

<div id="quran-hub">
    <h1>المصحف الإلكتروني الملكي</h1>

    <div id="loading" class="loading-overlay">جاري استحضار الألواح السلطانية...</div>

    <div id="main-ui" style="display:none;">
        <div class="controls">
            <select id="surah-select" style="flex: 2;">
                <option value="">اختر السورة الشريفة...</option>
            </select>
            <button onclick="changeSurah(-1)">السابق</button>
            <button onclick="changeSurah(1)">التالي</button>
        </div>

        <div id="display-area"></div>
    </div>
</div>

<script>
    let rawData = [];
    
    // مترجم ذكي لتنظيف الحروف المقطعة والرموز في ملفك
    function smartDecoder(text) {
        if (!text) return "";
        // 1. حذف المسافات الزائدة بين الحروف (ب س م -> بسم)
        let clean = text.replace(/\s+/g, '');
        // 2. تصحيح بعض الرموز التي تظهر نتيجة التشفير الخاطئ في ملفك
        // ملاحظة: هذه الخريطة تحسن القراءة ولكن الترميز التالف جداً قد يظل رمزاً
        return clean;
    }

    async function init() {
        try {
            const response = await fetch('quran.json');
            const data = await response.json();
            
            // استخراج مصفوفة السور برمجياً مهما كان اسم المفتاح غريباً
            const rootKey = Object.keys(data)[0];
            rawData = data[rootKey];

            const select = document.getElementById('surah-select');
            rawData.forEach((s, i) => {
                const opt = document.createElement('option');
                opt.value = i;
                opt.innerText = `سورة رقم ${i + 1}`; // عرض الرقم لأن الأسماء مشوهة بالملف
                select.appendChild(opt);
            });

            document.getElementById('loading').style.display = 'none';
            document.getElementById('main-ui').style.display = 'block';

            select.onchange = (e) => renderSurah(e.target.value);
        } catch (e) {
            document.getElementById('loading').innerText = "حدث خطأ في قراءة الألواح! تأكد من ملف quran.json";
        }
    }

    function renderSurah(index) {
        if (index === "") return;
        const surah = rawData[index];
        const display = document.getElementById('display-area');
        display.innerHTML = "";

        // جلب مصفوفة الآيات (الحقل الذي يحتوي على الترقيم)
        const keys = Object.keys(surah);
        const ayahs = surah[keys[0]] || []; // محاولة جلب الآيات

        ayahs.forEach((a, i) => {
            if (a.length < 5 && i > ayahs.length - 3) return; // تجاهل التذييلات غير النصية
            const cleanText = smartDecoder(a);
            display.innerHTML += `<div class="ayah">${cleanText} <span class="ayah-num">${i + 1}</span></div>`;
        });
        
        display.scrollTop = 0;
    }

    function changeSurah(dir) {
        const select = document.getElementById('surah-select');
        let nextIdx = parseInt(select.value || 0) + dir;
        if (nextIdx >= 0 && nextIdx < rawData.length) {
            select.value = nextIdx;
            renderSurah(nextIdx);
        }
    }

    init();
</script>

</body>
</html>
